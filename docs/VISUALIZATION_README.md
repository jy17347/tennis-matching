# 📊 Visualization.py 사용 가이드

## 🎯 개요
`visualization.py`는 기존 테니스 매칭 결과 엑셀 파일을 읽어서:
- 제약조건 검증 (15경기, 혼복 참여, 실력 밸런스 등)
- 상세 통계 분석 및 시각화
- PDF 타임표 자동 생성

## 📋 기능

### 1. 제약조건 검증
- ✅ 총 15경기 생성 여부
- ✅ 타임슬롯당 최대 12명 (3코트 × 4명)
- ✅ 모든 선수 혼복 최소 1회 참여
- ✅ 선수별 참여 횟수 균형 (차이 2경기 이하)
- ✅ 연속 경기 체크
- ✅ 같은 팀/상대 중복 체크
- ✅ 실력 밸런스 분석

### 2. 통계 출력
- 📊 경기 목록 (타임, 코트, 경기타입, 팀 구성, 실력차)
- 👥 선수별 참여 통계 (총 참여, 혼복/남복/여복, 참여 타임)
- 📈 위반 사항 및 주의사항

### 3. PDF 생성
- 📄 A4 가로 레이아웃
- 🎨 컬러풀한 타임표 (경기 타입별 색상)
- 📋 선수별 통계 포함
- ⚠️ 검증 결과 포함

## 🚀 사용법

### 기본 사용 (custom.xlsx 파일)
```cmd
python visualization.py
```
- 프로젝트 루트의 `custom.xlsx` 파일을 기본으로 사용합니다.
- `custom.xlsx`가 없으면 `results` 폴더에서 가장 최신 파일을 자동 선택합니다.

### 특정 파일 지정
```cmd
python visualization.py "results\테니스_매칭결과_20260117_024813.xlsx"
```

### PDF 생성 제외
```cmd
python visualization.py --no-pdf
```

### 출력 PDF 경로 지정
```cmd
python visualization.py --output "custom_timetable.pdf"
```

## 📂 입력 파일 형식

### custom.xlsx 파일 (기본 형식)

엑셀 파일은 최소한 다음 시트를 포함해야 합니다:

#### 1. 매칭결과 시트 (필수)
최소 컬럼: `코트`, `타임`, `팀1_선수1`, `팀1_선수2`, `팀2_선수1`, `팀2_선수2`

추가 컬럼(선택): `경기타입`, `팀1_평균실력`, `팀2_평균실력`, `팀평균_실력차`

**예시:**
```
코트 | 타임 | 팀1_선수1 | 팀1_선수2 | 팀2_선수1 | 팀2_선수2
-----|------|-----------|-----------|-----------|----------
  1  |  1   |  정우용   |  이도훈   |  박창민   |  이영호
  2  |  1   |  서지영   |  서윤식   |  김재혁   |  강경원
```

#### 2. 타임표 시트 (선택)
시각화에 직접 사용되지 않음

#### 3. 참여통계 시트 (선택)
있으면 사용, 없으면 자동 계산

컬럼: `성명`, `성별`, `실력`, `참여횟수`, `남복`, `혼복`, `여복`

### 선수 정보
`dataset/roster.xlsx` 파일이 있으면 자동으로 선수 성별과 실력 정보를 읽어옵니다.
- 없으면 매칭결과에서 경기 타입을 추론합니다.

## 📤 출력 결과

### 1. 콘솔 출력
```
============================================================
🎾 테니스 매칭 결과 시각화 및 검증 도구
============================================================
✅ 로드 완료: 15개 경기
✅ 파싱 완료: 13명 선수, 15개 경기

📋 제약조건 검증 중...
✅ 총 경기 수: 15경기
✅ 타임슬롯별 인원: T1=12명, T2=12명, ...
✅ 모든 선수 혼복 참여

📊 검증 결과 요약
✅ 모든 필수 제약조건 충족
⚠️  주의사항: 2건
   ⚠️  연속 경기: 정우용 (T1→T2), ...
```

### 2. PDF 파일
- 파일명: `테니스_타임표_YYYYMMDD_HHMMSS.pdf`
- 위치: 원본 엑셀 파일과 동일한 폴더
- 내용:
  - 📋 타임표 (3코트 × 5타임)
  - 👥 선수별 통계
  - ⚠️ 검증 결과

## 🔍 검증 결과 해석

### ✅ 필수 제약조건 충족
모든 제약조건을 만족하는 완벽한 매칭입니다.

### ❌ 제약조건 위반
다음과 같은 필수 조건을 위반했습니다:
- 총 경기 수가 15개가 아님
- 혼복 미참여 선수 존재
- 타임슬롯당 12명 초과

### ⚠️ 주의사항
필수는 아니지만 개선이 권장됩니다:
- 연속 경기 (선수 피로도)
- 중복 팀/상대 (다양성 저하)
- 실력 불균형 (승부 예측 가능)

## 📝 예제

### 예제 1: 기본 파일(custom.xlsx) 분석
```cmd
python visualization.py
```

**출력:**
```
📂 기본 파일 사용: custom.xlsx
✅ 로드 완료: 15개 경기
✅ 파싱 완료: 13명 선수, 15개 경기
✅ 모든 필수 제약조건 충족
✅ PDF 생성 완료: C:\project\matching\custom_타임표.pdf
```

### 예제 2: 특정 파일 분석 (PDF 제외)
```cmd
python visualization.py "results\테니스_매칭결과_20260117_024813.xlsx" --no-pdf
```

**출력:**
```
❌ 제약조건 위반: 1건
   ❌ 혼복 미참여 선수: 이희연 (1명)
```

### 예제 3: 커스텀 PDF 출력
```cmd
python visualization.py --output "final_timetable.pdf"
```

## 🛠️ 기술 스택

### 필수 라이브러리
- `pandas`: 엑셀 데이터 처리
- `openpyxl`: 엑셀 파일 읽기
- `reportlab`: PDF 생성

### 선택 라이브러리
- 한글 폰트: `malgun.ttf` (Windows)

### 설치
```cmd
pip install pandas openpyxl reportlab
```

## 🔗 관련 파일

- `tennis_matching.py`: 매칭 알고리즘 (15경기 생성)
- `participation.xlsx`: 참여 선수 명단
- `roster.xlsx`: 전체 선수 데이터베이스
- `results/`: 매칭 결과 및 타임표 저장 폴더

## 💡 팁

1. **자동 분석**: 매칭 생성 후 자동으로 실행하려면:
   ```python
   import os
   os.system('python visualization.py')
   ```

2. **배치 처리**: 여러 파일 한번에 분석:
   ```cmd
   for %f in (results\*.xlsx) do python visualization.py "%f"
   ```

3. **비교 분석**: 여러 매칭 결과를 비교하려면 각각 실행하여 PDF 생성 후 비교

## ❓ FAQ

### Q: PDF가 생성되지 않습니다
A: `reportlab` 설치 확인: `pip install reportlab`

### Q: 한글이 깨집니다
A: Windows의 경우 `malgun.ttf` 폰트가 자동으로 사용됩니다. 다른 OS는 한글 폰트 경로를 수정하세요.

### Q: "파일을 찾을 수 없습니다" 오류
A: 파일 경로를 큰따옴표로 감싸세요: `"results\파일명.xlsx"`

### Q: 엑셀 파일 형식이 다릅니다
A: `tennis_matching.py`로 생성된 파일만 지원합니다. 컬럼명이 정확해야 합니다.

## 📞 문의

문제가 발생하면 다음을 확인하세요:
1. Python 버전 (3.7+)
2. 필수 라이브러리 설치
3. 엑셀 파일 형식 (3개 필수 시트)
4. 파일 경로 (한글 경로 지원)

---
**Version**: 1.0  
**Last Updated**: 2026-01-17  
**Author**: Tennis Matching System
